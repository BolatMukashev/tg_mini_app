<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <title>Donate Company</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: #121212;
            color: white;
            text-align: center;
            padding: 40px;
        }
        button {
            background-color: #0088cc;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>{{ text.title }}</h2>
    <p>{{ text.desc }}</p>
    <button id="open-bot">{{ text.button }}</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe.user;
        const ref = tg.initDataUnsafe.start_param;

        // если язык не передан — обновим URL с кодом языка из Telegram
        if (user?.language_code && !window.location.search.includes("lang=")) {
            const newUrl = `/?lang=${user.language_code}`;
            window.location.replace(newUrl);
        }

        fetch("/save_ref", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                tg_id: user?.id,
                ref: ref
            })
        });

        document.getElementById("open-bot").onclick = () => {
            const botUsername = "DonateCampaignBot";
            window.location.href = `https://t.me/${botUsername}?start=${ref}`;
        };
    </script>
</body>
</html>
